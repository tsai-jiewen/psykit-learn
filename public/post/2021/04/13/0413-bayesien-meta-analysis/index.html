<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>0413 bayesien meta-analysis | JackMD</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/about/">About</a></li>
      
      <li><a href="/categories/">Categories</a></li>
      
      <li><a href="/tags/">Tags</a></li>
      
      <li><a href="/post/">Blog</a></li>
      
      <li><a href="/index.xml">Subscribe</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">0413 bayesien meta-analysis</span></h1>
<h2 class="author">Jiewen Tsai</h2>
<h2 class="date">2021/04/13</h2>
</div>

<main>

<script src="/post/2021/04/13/0413-bayesien-meta-analysis/index_files/header-attrs/header-attrs.js"></script>


<pre class="r"><code>#install.packages(&quot;gemtc&quot;)
#install.packages(&quot;netmeta&quot;)
#install.packages(&quot;rjags&quot;)

library(gemtc)</code></pre>
<pre><code>## Loading required package: coda</code></pre>
<pre class="r"><code>library(netmeta)</code></pre>
<pre><code>## Loading required package: meta</code></pre>
<pre><code>## Loading &#39;meta&#39; package (version 4.16-1).
## Type &#39;help(meta)&#39; for a brief overview.</code></pre>
<pre><code>## 
## Attaching package: &#39;meta&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:gemtc&#39;:
## 
##     forest</code></pre>
<pre><code>## Loading &#39;netmeta&#39; package (version 1.3-0).
## Type &#39;help(&quot;netmeta-package&quot;)&#39; for a brief overview.</code></pre>
<pre class="r"><code>library(rjags)</code></pre>
<pre><code>## Linked to JAGS 4.3.0</code></pre>
<pre><code>## Loaded modules: basemod,bugs</code></pre>
<pre class="r"><code>library(rio)
library(igraph)</code></pre>
<pre><code>## 
## Attaching package: &#39;igraph&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     decompose, spectrum</code></pre>
<pre><code>## The following object is masked from &#39;package:base&#39;:
## 
##     union</code></pre>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.0 ──</code></pre>
<pre><code>## ✓ ggplot2 3.3.3     ✓ purrr   0.3.4
## ✓ tibble  3.0.5     ✓ dplyr   1.0.3
## ✓ tidyr   1.1.2     ✓ stringr 1.4.0
## ✓ readr   1.4.0     ✓ forcats 0.5.0</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## x dplyr::as_data_frame() masks tibble::as_data_frame(), igraph::as_data_frame()
## x purrr::compose()       masks igraph::compose()
## x tidyr::crossing()      masks igraph::crossing()
## x dplyr::filter()        masks stats::filter()
## x dplyr::groups()        masks igraph::groups()
## x dplyr::lag()           masks stats::lag()
## x purrr::simplify()      masks igraph::simplify()</code></pre>
<div id="excel-import" class="section level3">
<h3>(Excel import)</h3>
<pre class="r"><code># data(Senn2013)
data &lt;- import(&#39;data.xlsx&#39;) %&gt;% select(-`...1`)</code></pre>
<pre><code>## New names:
## * `` -&gt; ...1</code></pre>
<pre class="r"><code>data$treatment &lt;- as.factor(data$treatment)</code></pre>
<pre class="r"><code>network &lt;- mtc.network(data)

summary(network)</code></pre>
<pre><code>## $Description
## [1] &quot;MTC dataset: Network&quot;
## 
## $`Studies per treatment`
##      Acarbose    Benfluorex     Metformin      Miglitol  Pioglitazone 
##             3             2             8             3             3 
##       Placebo Rosiglitazone   Sitagliptin  Sulfonylurea  Vildagliptin 
##            19            10             1             3             1 
## 
## $`Number of n-arm studies`
## 2-arm 3-arm 
##    25     1 
## 
## $`Studies per treatment comparison`
##               t1            t2 nr
## 1       Acarbose     Metformin  1
## 2       Acarbose       Placebo  2
## 3       Acarbose  Sulfonylurea  1
## 4     Benfluorex       Placebo  2
## 5      Metformin  Pioglitazone  1
## 6      Metformin       Placebo  4
## 7      Metformin Rosiglitazone  2
## 8      Metformin  Sulfonylurea  1
## 9       Miglitol       Placebo  3
## 10  Pioglitazone       Placebo  1
## 11  Pioglitazone Rosiglitazone  1
## 12       Placebo Rosiglitazone  6
## 13       Placebo   Sitagliptin  1
## 14       Placebo  Vildagliptin  1
## 15 Rosiglitazone  Sulfonylurea  1</code></pre>
<pre class="r"><code>plot(network)</code></pre>
<p><img src="/post/2021/04/13/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<pre class="r"><code>plot(network, layout=layout.fruchterman.reingold)</code></pre>
<p><img src="/post/2021/04/13/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-3-2.png" width="672" /></p>
<pre class="r"><code>network$data.ab &lt;- network$data.ab %&gt;% rename(mean = diff)

network$data.ab$mean &lt;- as.numeric(as.integer(as.factor(network$data.ab$mean)))
network$data.ab$std.err &lt;- as.numeric(as.integer(as.factor(network$data.ab$std.err)))

#network$data.ab$mean &lt;- replace_na(network$data.ab$mean, 0)
#network$data.ab$std.err &lt;- replace_na(network$data.ab$std.err, 0)</code></pre>
</div>
<div id="模型編譯" class="section level3">
<h3>模型編譯</h3>
<pre class="r"><code>model &lt;- mtc.model(
  network,
  linearModel = &#39;random&#39;,
  n.chain = 4
)</code></pre>
<pre class="r"><code>mcmc1 &lt;- mtc.run(model, n.adapt = 50, n.iter = 1000, thin = 10)</code></pre>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 53
##    Unobserved stochastic nodes: 63
##    Total graph size: 730
## 
## Initializing model</code></pre>
<pre><code>## Warning in rjags::jags.model(file.model, data = syntax[[&quot;data&quot;]], inits =
## syntax[[&quot;inits&quot;]], : Adaptation incomplete</code></pre>
<pre><code>## NOTE: Stopping adaptation</code></pre>
<pre class="r"><code>mcmc2 &lt;- mtc.run(model, n.adapt = 5000, n.iter = 100000, thin = 10)</code></pre>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 53
##    Unobserved stochastic nodes: 63
##    Total graph size: 730
## 
## Initializing model</code></pre>
<pre class="r"><code>mcmc3 &lt;- mtc.run(model, n.adapt = 5000, n.iter = 100000, thin = 1)</code></pre>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 53
##    Unobserved stochastic nodes: 63
##    Total graph size: 730
## 
## Initializing model</code></pre>
</div>
<div id="section" class="section level3">
<h3></h3>
<pre class="r"><code>plot(mcmc1)</code></pre>
<p><img src="/post/2021/04/13/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-7-1.png" width="672" /><img src="/post/2021/04/13/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-7-2.png" width="672" /><img src="/post/2021/04/13/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-7-3.png" width="672" /><img src="/post/2021/04/13/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-7-4.png" width="672" /></p>
<pre class="r"><code>plot(mcmc2)</code></pre>
<p><img src="/post/2021/04/13/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-7-5.png" width="672" /><img src="/post/2021/04/13/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-7-6.png" width="672" /><img src="/post/2021/04/13/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-7-7.png" width="672" /><img src="/post/2021/04/13/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-7-8.png" width="672" /></p>
<pre class="r"><code>plot(mcmc3)</code></pre>
<p><img src="/post/2021/04/13/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-7-9.png" width="672" /><img src="/post/2021/04/13/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-7-10.png" width="672" /><img src="/post/2021/04/13/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-7-11.png" width="672" /><img src="/post/2021/04/13/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-7-12.png" width="672" /></p>
<pre class="r"><code>gelman.plot(mcmc1)</code></pre>
<p><img src="/post/2021/04/13/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-8-1.png" width="672" /><img src="/post/2021/04/13/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-8-2.png" width="672" /></p>
<pre class="r"><code>gelman.plot(mcmc2)</code></pre>
<p><img src="/post/2021/04/13/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-8-3.png" width="672" /><img src="/post/2021/04/13/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-8-4.png" width="672" /></p>
<pre class="r"><code>gelman.diag(mcmc1)$mpsrf</code></pre>
<pre><code>## [1] 1.449146</code></pre>
<pre class="r"><code>gelman.diag(mcmc2)$mpsrf</code></pre>
<pre><code>## [1] 1.018798</code></pre>
<pre class="r"><code>gelman.diag(mcmc3)$mpsrf</code></pre>
<pre><code>## [1] 1.005499</code></pre>
<pre class="r"><code>gemtc::forest(relative.effect(mcmc3, t1 = &quot;Placebo&quot;))</code></pre>
<p><img src="/post/2021/04/13/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>

</main>

  <footer>
  
  
  <hr/>
  © <a href="/">Jiewen Tsai</a> 2021 | <a href="https://github.com/tsai-jiewen">Github</a> | <a href="https://twitter.com/">Twitter</a>
  
  </footer>
  </body>
</html>


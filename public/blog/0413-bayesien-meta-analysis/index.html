<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title> 0413 bayesien meta-analysis - JackMD </title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="referrer" content="no-referrer">
    <meta name="description" content="" />
    <meta property="og:site_name" content="JackMD" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="/blog/0413-bayesien-meta-analysis/" />
    <meta property="og:title" content="0413 bayesien meta-analysis" />
    <meta property="og:image" content="/image/avatar.png" />
    <meta property="og:description" content="" />

    <meta name="twitter:card" content="summary_large_image" />
    
    <meta name="twitter:title" content="0413 bayesien meta-analysis" />
    <meta name="twitter:description" content="" />
    <meta name="twitter:image" content="/image/avatar.png" />

    <link rel="canonical" href="/blog/0413-bayesien-meta-analysis/">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha256-aAr2Zpq8MZ+YA/D6JtRD3xtrwpEz2IqOS+pWD/7XKIw=" crossorigin="anonymous" />

    <link rel="stylesheet" href="/css/custom.css" />

    
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/styles/tomorrow.min.css" integrity="sha256-0QU8ry64q+N6YBIEF/6XF6vUeF15gbNO4tLS6ikk0FI=" crossorigin="anonymous" />
    

    
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/progressively/1.2.5/progressively.min.css" integrity="sha256-xbqLYBMsjpuCihs+3Fgp/MFMtPdo2SWKoOjEWOqR4X0=" crossorigin="anonymous" />
    

    <link rel="shortcut icon"
        href="/image/favicon.ico">

    
        <link href="/index.xml" rel="alternate" type="application/rss+xml" title="JackMD" />
    
</head>

<body>
    
    <div class="my-4 my-md-5 header">
    <div class="container">
        <div class="row">
            <div class="col-auto offset-md-1 d-none d-md-block">
                
                    <a href="/">
                        <img class="ml-md-4 logo img-fluid d-block rounded-circle" src="/image/avatar.png" alt="logo">
                    </a>
                
            </div>
            <div class="col-auto align-self-center mr-auto">
                <a href="/">
                    <h1 class="name">Jiewen Tsai</h1>
                </a>

                <ul class="nav nav-primary">
                    
                        <li class="nav-item">
                            <a class="text-uppercase nav-link text-about" href="/about/">
                                
                                About
                            </a>
                        </li>
                    
                        <li class="nav-item">
                            <a class="text-uppercase nav-link text-blog" href="/blog/">
                                
                                Blog
                            </a>
                        </li>
                    

                    
                </ul>

            </div>
        </div>
    </div>
</div>


    <div class="content">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-sm-12 col-md-10">
                    <h1 class="mx-0 mx-md-4 blog-post-title">0413 bayesien meta-analysis</h1>

                    <div class="mb-md-4 meta">
                        
                            
                                <span class="author" title="Jiewen Tsai">
                                    Jiewen Tsai
                                </span>
                            
                        

                        <span class="date middot" title='Tue Apr 13 2021 00:00:00 UTC'>
                            2021-04-13
                        </span>

                        <span class="reading-time middot">
                            3 minute read
                        </span>

                        <div class="d-none d-md-inline tags">
                            <ul class="list-unstyled d-inline">
                                
                                    <li class="d-inline middot">
                                        <a href="/tags/r">R</a>
                                    </li>
                                
                                    <li class="d-inline middot">
                                        <a href="/tags/bayesien">bayesien</a>
                                    </li>
                                
                                    <li class="d-inline middot">
                                        <a href="/tags/meta-analysis">meta-analysis</a>
                                    </li>
                                
                            </ul>
                        </div>

                        <div class="d-none d-md-inline tags">
                            <ul class="list-unstyled d-inline">
                                
                                
                            </ul>
                        </div>
                    </div>

                    <div class="markdown">
                        
    
    
<script src="/blog/0413-bayesien-meta-analysis/index_files/header-attrs/header-attrs.js"></script>


<pre class="r"><code>#install.packages(&quot;gemtc&quot;)
#install.packages(&quot;netmeta&quot;)
#install.packages(&quot;rjags&quot;)

library(gemtc)</code></pre>
<pre><code>## Loading required package: coda</code></pre>
<pre class="r"><code>library(netmeta)</code></pre>
<pre><code>## Loading required package: meta</code></pre>
<pre><code>## Loading &#39;meta&#39; package (version 4.16-1).
## Type &#39;help(meta)&#39; for a brief overview.</code></pre>
<pre><code>## 
## Attaching package: &#39;meta&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:gemtc&#39;:
## 
##     forest</code></pre>
<pre><code>## Loading &#39;netmeta&#39; package (version 1.3-0).
## Type &#39;help(&quot;netmeta-package&quot;)&#39; for a brief overview.</code></pre>
<pre class="r"><code>library(rjags)</code></pre>
<pre><code>## Linked to JAGS 4.3.0</code></pre>
<pre><code>## Loaded modules: basemod,bugs</code></pre>
<pre class="r"><code>library(rio)
library(igraph)</code></pre>
<pre><code>## 
## Attaching package: &#39;igraph&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     decompose, spectrum</code></pre>
<pre><code>## The following object is masked from &#39;package:base&#39;:
## 
##     union</code></pre>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.0 ──</code></pre>
<pre><code>## ✓ ggplot2 3.3.3     ✓ purrr   0.3.4
## ✓ tibble  3.0.5     ✓ dplyr   1.0.3
## ✓ tidyr   1.1.2     ✓ stringr 1.4.0
## ✓ readr   1.4.0     ✓ forcats 0.5.0</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## x dplyr::as_data_frame() masks tibble::as_data_frame(), igraph::as_data_frame()
## x purrr::compose()       masks igraph::compose()
## x tidyr::crossing()      masks igraph::crossing()
## x dplyr::filter()        masks stats::filter()
## x dplyr::groups()        masks igraph::groups()
## x dplyr::lag()           masks stats::lag()
## x purrr::simplify()      masks igraph::simplify()</code></pre>
<div id="excel-import" class="section level3">
<h3>(Excel import)</h3>
<pre class="r"><code># data(Senn2013)
data &lt;- import(&#39;data.xlsx&#39;) %&gt;% select(-`...1`)</code></pre>
<pre><code>## New names:
## * `` -&gt; ...1</code></pre>
<pre class="r"><code>data$treatment &lt;- as.factor(data$treatment)</code></pre>
<pre class="r"><code>network &lt;- mtc.network(data)

summary(network)</code></pre>
<pre><code>## $Description
## [1] &quot;MTC dataset: Network&quot;
## 
## $`Studies per treatment`
##      Acarbose    Benfluorex     Metformin      Miglitol  Pioglitazone 
##             3             2             8             3             3 
##       Placebo Rosiglitazone   Sitagliptin  Sulfonylurea  Vildagliptin 
##            19            10             1             3             1 
## 
## $`Number of n-arm studies`
## 2-arm 3-arm 
##    25     1 
## 
## $`Studies per treatment comparison`
##               t1            t2 nr
## 1       Acarbose     Metformin  1
## 2       Acarbose       Placebo  2
## 3       Acarbose  Sulfonylurea  1
## 4     Benfluorex       Placebo  2
## 5      Metformin  Pioglitazone  1
## 6      Metformin       Placebo  4
## 7      Metformin Rosiglitazone  2
## 8      Metformin  Sulfonylurea  1
## 9       Miglitol       Placebo  3
## 10  Pioglitazone       Placebo  1
## 11  Pioglitazone Rosiglitazone  1
## 12       Placebo Rosiglitazone  6
## 13       Placebo   Sitagliptin  1
## 14       Placebo  Vildagliptin  1
## 15 Rosiglitazone  Sulfonylurea  1</code></pre>
<pre class="r"><code>plot(network)</code></pre>
<p><img src="/blog/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<pre class="r"><code>plot(network, layout=layout.fruchterman.reingold)</code></pre>
<p><img src="/blog/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-3-2.png" width="672" /></p>
<pre class="r"><code>network$data.ab &lt;- network$data.ab %&gt;% rename(mean = diff)

network$data.ab$mean &lt;- as.numeric(as.integer(as.factor(network$data.ab$mean)))
network$data.ab$std.err &lt;- as.numeric(as.integer(as.factor(network$data.ab$std.err)))

#network$data.ab$mean &lt;- replace_na(network$data.ab$mean, 0)
#network$data.ab$std.err &lt;- replace_na(network$data.ab$std.err, 0)</code></pre>
</div>
<div id="模型編譯" class="section level3">
<h3>模型編譯</h3>
<pre class="r"><code>model &lt;- mtc.model(
  network,
  linearModel = &#39;random&#39;,
  n.chain = 4
)</code></pre>
<pre class="r"><code>mcmc1 &lt;- mtc.run(model, n.adapt = 50, n.iter = 1000, thin = 10)</code></pre>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 53
##    Unobserved stochastic nodes: 63
##    Total graph size: 730
## 
## Initializing model</code></pre>
<pre><code>## Warning in rjags::jags.model(file.model, data = syntax[[&quot;data&quot;]], inits =
## syntax[[&quot;inits&quot;]], : Adaptation incomplete</code></pre>
<pre><code>## NOTE: Stopping adaptation</code></pre>
<pre class="r"><code>mcmc2 &lt;- mtc.run(model, n.adapt = 5000, n.iter = 100000, thin = 10)</code></pre>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 53
##    Unobserved stochastic nodes: 63
##    Total graph size: 730
## 
## Initializing model</code></pre>
<pre class="r"><code>mcmc3 &lt;- mtc.run(model, n.adapt = 5000, n.iter = 100000, thin = 1)</code></pre>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 53
##    Unobserved stochastic nodes: 63
##    Total graph size: 730
## 
## Initializing model</code></pre>
</div>
<div id="section" class="section level3">
<h3></h3>
<pre class="r"><code>plot(mcmc1)</code></pre>
<p><img src="/blog/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-7-1.png" width="672" /><img src="/blog/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-7-2.png" width="672" /><img src="/blog/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-7-3.png" width="672" /><img src="/blog/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-7-4.png" width="672" /></p>
<pre class="r"><code>plot(mcmc2)</code></pre>
<p><img src="/blog/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-7-5.png" width="672" /><img src="/blog/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-7-6.png" width="672" /><img src="/blog/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-7-7.png" width="672" /><img src="/blog/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-7-8.png" width="672" /></p>
<pre class="r"><code>plot(mcmc3)</code></pre>
<p><img src="/blog/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-7-9.png" width="672" /><img src="/blog/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-7-10.png" width="672" /><img src="/blog/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-7-11.png" width="672" /><img src="/blog/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-7-12.png" width="672" /></p>
<pre class="r"><code>gelman.plot(mcmc1)</code></pre>
<p><img src="/blog/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-8-1.png" width="672" /><img src="/blog/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-8-2.png" width="672" /></p>
<pre class="r"><code>gelman.plot(mcmc2)</code></pre>
<p><img src="/blog/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-8-3.png" width="672" /><img src="/blog/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-8-4.png" width="672" /></p>
<pre class="r"><code>gelman.diag(mcmc1)$mpsrf</code></pre>
<pre><code>## [1] 1.449146</code></pre>
<pre class="r"><code>gelman.diag(mcmc2)$mpsrf</code></pre>
<pre><code>## [1] 1.018798</code></pre>
<pre class="r"><code>gelman.diag(mcmc3)$mpsrf</code></pre>
<pre><code>## [1] 1.005499</code></pre>
<pre class="r"><code>gemtc::forest(relative.effect(mcmc3, t1 = &quot;Placebo&quot;))</code></pre>
<p><img src="/blog/0413-bayesien-meta-analysis/index_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>



                    </div>

                    
                        <div class="navigation">
                            <div class="row">
                                <div class="col-12 col-md-6">
                                    
                                        <div class="mx-0 mx-md-4 mt-4 text-left">
                                            <a href="/blog/2020-12-01-r-rmarkdown/">« Hello R Markdown</a>
                                        </div>
                                    
                                </div>
                                <div class="col-12 col-md-6">
                                    
                                        <div class="mx-0 mx-md-4 mt-4 text-right">
                                            <a href="/blog/item-analysis-0506/">item_analysis 0506 »</a>
                                        </div>
                                    
                                </div>
                            </div>
                        </div>
                    
                </div>
            </div>
        </div>
    </div>

    <section id="comments">

      <div class="py-3 content">
            <div class="container">
                  <div class="row justify-content-center">
                        <div class="col-sm-12 col-md-10">
                              <div class="comments">
                                    <div id="disqus_thread"></div>
                              </div>
                        </div>
                  </div>
            </div>
      </div>

      <script type="text/javascript">
            (function () {
                  
                  
                  if (window.location.hostname == "localhost")
                        return;

                  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                  var disqus_shortname = 'https-jackmd-netlify-app';
                  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
      </script>
      <noscript>
            Please enable JavaScript to view the
            <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
      </noscript>
</section>
    <div class="my-4 footer">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-sm-12 col-md-5">
                
                    <div class="mx-0 mx-md-4 text-left">
                        
                            <a href="/">© 2021 Jiewen Tsai</a>
                        
                    </div>
                
            </div>
            <div class="col-sm-12 col-md-5">
                <div class="mx-0 mx-md-4 text-right">
                    
                        <a href="https://github.com/tsai-jiewen" target="_blank">
                            <img class="icon" src="/img/github.svg" alt="GitHub" />
                        </a>
                    

                    

                    

                    

                    

                    

                    

                    

                    
                    <a href="mailto:example@example.com">
                        <img class="icon" src="/img/email.svg" alt="Email" />
                    </a>
                    

                    
                        <a href="/index.xml" class="mr-0">
                            <img class="icon" src="/img/rss.svg" alt="RSS" />
                        </a>
                    

                    
                </div>
            </div>
        </div>
    </div>
</div>



    

    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/highlight.min.js" integrity="sha256-sNPiigbfSkqUzMc5rgrdztLnneCMAp6W9wetJUZu9Zw=" crossorigin="anonymous"></script>
        
        <script>
            window.addEventListener('load', function() {
                hljs.initHighlighting();
            }, true);
        </script>
    

    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/progressively/1.2.5/progressively.min.js" integrity="sha256-LvFVlLdfGI3WeEH+8Ni4kxLm02g2GlOfeGCGLXfRk/U=" crossorigin="anonymous"></script>
        <script>
            window.addEventListener('load', function() {
                progressively.init({delay: 30, throttle: 50});
            }, true);
        </script>
    

    
    
        
<script src="/js/math-code.js"></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>


    
</body>

</html>
